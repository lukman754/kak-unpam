<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kalkulator KAK</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/css/select2.min.css" rel="stylesheet">
    <link
        href="https://cdnjs.cloudflare.com/ajax/libs/select2-bootstrap-5-theme/1.3.0/select2-bootstrap-5-theme.min.css"
        rel="stylesheet">
    <script src="https://kit.fontawesome.com/f59e2d85df.js" crossorigin="anonymous"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <meta name="theme-color" content="#4f46e5">
    <style>
        :root {
            --primary: #4f46e5;
            --primary-hover: #4338ca;
            --primary-light: #eef2ff;
            --secondary: #6b7280;
            --border: #e5e7eb;
            --background: #f9fafb;
            --card-bg: #ffffff;
            --text-primary: #111827;
            --text-secondary: #4b5563;
            --success: #10b981;
            --success-light: #d1fae5;
            --danger: #ef4444;
            --danger-light: #fee2e2;
            --warning: #f59e0b;
            --warning-light: #fef3c7;
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            --shadow-md: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            --radius-sm: 0.375rem;
            --radius: 0.5rem;
            --radius-lg: 0.75rem;
        }

        * {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        body {
            background-color: var(--background);
            color: var(--text-primary);
            line-height: 1.5;
            margin: 0;
            padding: 0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            background: var(--card-bg);
            border-bottom: 1px solid var(--border);
            padding: 1rem 0;
            position: sticky;
            top: 0;
            z-index: 50;
            backdrop-filter: blur(8px);
            background-color: rgba(255, 255, 255, 0.8);
        }

        .header-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            max-width: 1280px;
            margin: 0 auto;
            padding: 0 1.5rem;
            width: 100%;
        }

        .disclaimer-banner {
            background-color: var(--primary-light);
            color: var(--primary);
            padding: 0.75rem 1rem;
            text-align: center;
            font-size: 0.875rem;
            font-weight: 500;
            border-bottom: 1px solid rgba(79, 70, 229, 0.2);
        }

        .disclaimer-banner p {
            margin: 0;
            max-width: 65ch;
            margin: 0 auto;
        }

        .btn-custom, .btn-primary {
            background-color: var(--primary);
            color: white;
            border: 1px solid var(--primary);
            padding: 0.625rem 1.25rem;
            border-radius: var(--radius);
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            box-shadow: var(--shadow-sm);
        }

        .btn-custom:hover, .btn-primary:hover {
            background-color: var(--primary-hover);
            color: white;
            border-color: var(--primary-hover);
            transform: translateY(-1px);
            box-shadow: var(--shadow);
        }

        .btn-custom:active, .btn-primary:active {
            transform: translateY(0);
        }

        .btn-success {
            background-color: var(--success);
            color: white;
            border: 1px solid var(--success);
            padding: 0.5rem 1.25rem;
            border-radius: 6px;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-success:hover {
            background-color: #047857;
            border-color: #047857;
            color: white;
        }

        .card {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            overflow: hidden;
            transition: all 0.2s ease;
            height: 100%;
            box-shadow: var(--shadow);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .card:hover {
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.1);
        }

        .card-header {
            padding: 1.25rem 1.5rem;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: var(--card-bg);
        }

        .card-title {
            font-size: 1.125rem;
            font-weight: 600;
            margin: 0;
        }

        .card-body {
            padding: 1.5rem;
        }

        .form-select, .form-control {
            width: 100%;
            padding: 0.625rem 0.875rem;
            border: 1px solid var(--border);
            border-radius: 6px;
            background-color: var(--background);
            color: var(--text-primary);
            font-size: 0.875rem;
            transition: border-color 0.2s ease;
        }

        .form-select:focus, .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(0, 0, 0, 0.1);
        }

        .table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            background: var(--card-bg);
            border-radius: var(--radius);
            overflow: hidden;
        }

        .table th {
            text-align: left;
            padding: 1rem 1.25rem;
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            background-color: var(--primary-light);
            border-bottom: 1px solid var(--border);
            white-space: nowrap;
        }

        .table td {
            padding: 1rem 1.25rem;
            font-size: 0.875rem;
            border-bottom: 1px solid var(--border);
            vertical-align: middle;
        }

        .table tbody tr:last-child td {
            border-bottom: none;
        }

        .footer {
            background: var(--card-bg);
            border-top: 1px solid var(--border);
            padding: 2rem 0;
            margin-top: auto;
        }

        .social-icons {
            display: flex;
            justify-content: center;
            gap: 1.5rem;
            margin-bottom: 1rem;
        }

        .social-icons a {
            color: var(--text-secondary);
            transition: color 0.2s ease;
        }

        .social-icons a:hover {
            color: var(--primary);
        }

        .text-success {
            color: var(--success);
            background-color: var(--success-bg);
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-weight: 500;
            font-size: 0.75rem;
        }

        .btn-sm {
            padding: 0.25rem 0.5rem;
            font-size: 0.75rem;
            border-radius: 4px;
            background: none;
            border: none;
            cursor: pointer;
            color: var(--text-secondary);
            transition: all 0.2s ease;
        }

        .btn-sm:hover {
            color: var(--danger);
            background-color: var(--danger-bg);
        }

        .container {
            width: 100%;
            max-width: 1280px;
            margin: 0 auto;
            padding: 2rem 1.5rem;
            flex: 1;
        }

        .mb-3 {
            margin-bottom: 1rem;
        }

        .text-end {
            text-align: right;
        }

        .float-end {
            float: right;
        }

        .small {
            font-size: 0.75rem;
        }

        .fw-bold {
            font-weight: 600;
        }
    </style>
</head>

<body>
    <!-- Header -->
    <div class="disclaimer-banner">
        <p><strong>Peringatan:</strong> Program ini hanya sebagai simulasi untuk menghitung point KAK berdasarkan luaran yang sudah diupload ke SISPEMA oleh mahasiswa dan sudah divalidasi. Hasil perhitungan bersifat simulasi dan tidak menggantikan validasi resmi dari universitas.</p>
    </div>
    <div class="header">
        <div class="container">
            <div style="display: flex; align-items: center;">
                <img src="logo-unpam.png" width="40" height="40" class="me-3" alt="Logo UNPAM" style="border-radius: 8px;">
                <div>
                    <div style="font-size: 1.25rem; font-weight: 600; line-height: 1.2;">UNIVERSITAS PAMULANG</div>
                    <div style="font-size: 0.875rem; color: var(--text-secondary);">Kredit Aktivitas Mahasiswa</div>
                </div>
            </div>
        </div>
    </div>

    <div class="container" style="padding-top: 1rem; padding-bottom: 4rem;">
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem;">
            <!-- Selection Form -->
            <div>
                <div class="card border-0 shadow-sm">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="card-title mb-0">Pilih Kegiatan</h5>
                        <a class="btn btn-primary" href="SK-KAK.pdf" download="SK-KAK.pdf">
                            Unduh SK-KAK <i class="fa-solid fa-cloud-arrow-down"></i>
                        </a>

                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <select class="form-select" id="kegiatan">
                                <option value="">Pilih Kegiatan...</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="kategori" class="form-label">Kategori</label>
                            <select class="form-select" id="kategori" disabled>
                                <option value="">Pilih Kategori...</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="nilai" class="form-label">Nilai</label>
                            <input type="text" class="form-control text-success fw-bold" id="nilai" readonly>
                        </div>
                        <button class="btn btn-custom float-end" id="tambahKegiatan" disabled>Tambah ke List</button>
                    </div>
                </div>
            </div>

            <!-- Selected Activities List -->
            <div>
                <div class="card border-0 shadow-sm">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="card-title mb-0">List Kegiatan yang Diikuti</h5>
                        <button class="btn btn-success" id="printTable">Cetak <i class="fa-solid fa-image"></i></button>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table" id="listTable">
                                <thead>
                                    <tr>
                                        <th>NO</th>
                                        <th>KEGIATAN</th>
                                        <th>KATEGORI</th>
                                        <th>POINT</th>
                                        <th>AKSI</th>
                                    </tr>
                                </thead>
                                <tbody id="listKegiatan"></tbody>
                                <tfoot>
                                    <tr class="fw-bold">
                                        <td colspan="3" class="text-end">Total Point:</td>
                                        <td colspan="2" id="totalNilai">0</td>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <div class="footer">
        <div class="container" style="text-align: center;">
            <div class="social-icons">
                <a href="https://github.com/Lukman754" target="_blank" rel="noopener noreferrer">
                    <i class="fab fa-github fa-lg"></i>
                </a>
                <a href="https://facebook.com/lukman-mauludin-754" target="_blank" rel="noopener noreferrer">
                    <i class="fab fa-facebook fa-lg"></i>
                </a>
                <a href="https://instagram.com/_.chopin" target="_blank" rel="noopener noreferrer">
                    <i class="fab fa-instagram fa-lg"></i>
                </a>
            </div>
            <div style="margin-top: 0.5rem; font-size: 0.875rem; color: var(--text-secondary);">
                © 2024 Lukman Muludin
            </div>
        </div>
    </div>

    <!-- Add FontAwesome -->
    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>


    <!-- Alert Modal -->
    <div class="modal fade" id="alertModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Peringatan</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    Mohon tambahkan kegiatan terlebih dahulu
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Tutup</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <script type="module">
        import { kakData } from './data.js';

        // Initialize variables
        let selectedActivities = [];
        let alertModal;

        // Initialize modal
        document.addEventListener('DOMContentLoaded', function() {
            alertModal = new bootstrap.Modal(document.getElementById('alertModal'));
        });

        // Initialize Select2 for kegiatan dropdown with numbered options
        $(document).ready(function() {
            const kegiatanSelect = $('#kegiatan');

            // Create numbered options
            const options = kakData.reduce((unique, item) => {
                const exists = unique.find(u => u.Kegiatan.Nama === item.Kegiatan.Nama);
                if (!exists) {
                    unique.push(item);
                }
                return unique;
            }, []).map((item, index) => ({
                id: item.Kegiatan.Nama,
                text: `${index + 1}. ${item.Kegiatan.Nama}`
            }));

            // Initialize Select2
            kegiatanSelect.select2({
                theme: 'bootstrap-5',
                data: options,
                placeholder: 'Cari atau pilih kegiatan...',
                allowClear: true,
                width: '100%'
            });

            // Event listener for kegiatan change
            kegiatanSelect.on('change', updateKategori);
        });

        // Event Listeners
        document.getElementById('kategori').addEventListener('change', updateNilai);
        document.getElementById('tambahKegiatan').addEventListener('click', tambahKegiatan);
        document.getElementById('printTable').addEventListener('click', printTableToImage);

        function updateKategori() {
            const kategoriSelect = document.getElementById('kategori');
            const selectedKegiatan = $('#kegiatan').val();

            if (!selectedKegiatan) {
                kategoriSelect.innerHTML = '<option value="">Pilih Kategori...</option>';
                kategoriSelect.disabled = true;
                return;
            }

            kategoriSelect.disabled = false;
            kategoriSelect.innerHTML = '<option value="">Pilih Kategori...</option>';

            const categories = kakData
                .filter(item => item.Kegiatan.Nama === selectedKegiatan)
                .map(item => item.Kegiatan.Kategori);

            categories.forEach(category => {
                if (category) {
                    const option = document.createElement('option');
                    option.value = category;
                    option.textContent = category;
                    kategoriSelect.appendChild(option);
                }
            });

            document.getElementById('nilai').value = '';
            document.getElementById('tambahKegiatan').disabled = true;
        }

        function updateNilai() {
            const selectedKegiatan = $('#kegiatan').val();
            const selectedKategori = document.getElementById('kategori').value;
            const nilaiInput = document.getElementById('nilai');

            const activity = kakData.find(item =>
                item.Kegiatan.Nama === selectedKegiatan &&
                (!item.Kegiatan.Kategori || item.Kegiatan.Kategori === selectedKategori)
            );

            if (activity) {
                nilaiInput.value = activity.Nilai;
                document.getElementById('tambahKegiatan').disabled = false;
            } else {
                nilaiInput.value = '';
                document.getElementById('tambahKegiatan').disabled = true;
            }
        }

        function tambahKegiatan() {
            const kegiatan = $('#kegiatan').val();
            const kategori = document.getElementById('kategori').value;
            const nilai = document.getElementById('nilai').value;

            if (kegiatan && nilai) {
                selectedActivities.push({
                    kegiatan,
                    kategori,
                    nilai: parseInt(nilai)
                });
                updateListKegiatan();
                resetForm();
            }
        }

        function hapusKegiatan(index) {
            selectedActivities.splice(index, 1);
            updateListKegiatan();
        }

        function updateListKegiatan() {
            const listKegiatan = document.getElementById('listKegiatan');
            const totalNilai = document.getElementById('totalNilai');

            listKegiatan.innerHTML = '';
            let total = 0;

            selectedActivities.forEach((activity, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${activity.kegiatan}</td>
                    <td>${activity.kategori || '-'}</td>
                    <td><span class='fw-bold text-success bg-success-subtle px-2 rounded-pill small'>${activity.nilai}</span></td>
                    <td>
                        <button class="btn btn-sm" data-index="${index}">
                            <i class="fa-solid fa-delete-left text-danger small"></i>
                        </button>
                    </td>
                `;
                listKegiatan.appendChild(row);

                row.querySelector('button').addEventListener('click', function() {
                    hapusKegiatan(index);
                });

                total += activity.nilai;
            });

            totalNilai.textContent = `${total}`;
        const predikat = document.createElement('tr');
        let predikatText = '';
        let badgeClass = '';
        let emote = '';

        if (total > 200) {
            predikatText = 'Unggul';
            badgeClass = 'bg-primary';
            emote = '😃';
        } else if (total >= 100) {
            predikatText = 'Sangat Baik';
            badgeClass = 'bg-success';
            emote = '😊';
        } else if (total >= 50) {
            predikatText = 'Baik';
            badgeClass = 'bg-warning';
            emote = '🙂';
        } else {
            predikatText = 'Kurang';
            badgeClass = 'bg-danger';
            emote = '😟';
        }

        predikat.innerHTML = `
            <td colspan="3" class="text-end fw-bold">Predikat:</td>
            <td colspan="2">
                <span class="badge ${badgeClass}">${predikatText} ${emote}</span>
            </td>
        `;
        listKegiatan.appendChild(predikat);
        }

        function resetForm() {
            $('#kegiatan').val(null).trigger('change');
            document.getElementById('kategori').innerHTML = '<option value="">Pilih Kategori...</option>';
            document.getElementById('kategori').disabled = true;
            document.getElementById('nilai').value = '';
            document.getElementById('tambahKegiatan').disabled = true;
        }

        async function printTableToImage() {
            // Check if there are any activities
            if (selectedActivities.length === 0) {
                alertModal.show();
                return;
            }
            
            const table = document.getElementById('listTable');
            
            try {
                // Create canvas from table
                const canvas = await html2canvas(table, {
                    backgroundColor: '#ffffff',
                    scale: 2 // Higher quality
                });

                // Convert to image and download
                const image = canvas.toDataURL('image/jpeg', 1.0);
                const link = document.createElement('a');
                link.download = 'KAK_Kegiatan.jpg';
                link.href = image;
                link.click();
            } catch (error) {
                console.error('Error generating image:', error);
                alert('Terjadi kesalahan saat membuat gambar. Silakan coba lagi.');
            }
        }

       
    </script>

</body>

</html>
